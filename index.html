<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPIC Penguin Rescue</title>
    <style>
        :root {
            --sky-blue: #87ceeb;
            --ice-white: #f0f8ff;
            --term-green: #00ff41;
            --error-red: #ff4757;
            --ocean-blue: #0a3d62; /* ã‚ˆã‚Šæ·±ã„æµ·ã®è‰²ã«å¤‰æ›´ */
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', 'Hiragino Kaku Gothic ProN', sans-serif;
            background-color: var(--sky-blue);
        }

        /* --- èƒŒæ™¯ãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        #world {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #sky {
            flex: 2;
            position: relative;
            background: linear-gradient(to bottom, #2980b9, #6dd5fa);
            overflow: hidden;
        }

        #typing-area {
            flex: 3;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        /* --- ã€å¤‰æ›´ã€‘å‚é“ã«ã™ã‚‹ --- */
        #ground {
            flex: 2;
            background: linear-gradient(160deg, #fff 0%, #dff9fb 100%);
            position: relative;
            /* å·¦ãŒé«˜ãã€å³ãŒä½ã„å‚é“ã®å½¢ã«åˆ‡ã‚ŠæŠœã */
            clip-path: polygon(0 15%, 85% 90%, 85% 100%, 0 100%);
        }

        /* --- é›²ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
        .cloud {
            position: absolute;
            background: #fff;
            width: 100px; height: 40px;
            border-radius: 50px;
            opacity: 0.8;
            animation: moveCloud linear infinite;
        }
        @keyframes moveCloud {
            from { transform: translateX(110vw); }
            to { transform: translateX(-20vw); }
        }

        /* --- ã‚¿ã‚¤ãƒ”ãƒ³ã‚°UI --- */
        #cmd-display {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 80%;
        }

        #target-desc { color: #ecf0f1; font-size: 1.2rem; margin-bottom: 10px; }
        #target-text { font-family: 'Consolas', monospace; font-size: 2.5rem; color: #fff; letter-spacing: 2px; }
        .correct { color: var(--term-green); text-shadow: 0 0 10px var(--term-green); }
        .current { border-bottom: 3px solid #fff; }

        /* --- ãƒšãƒ³ã‚®ãƒ³ã¨ç©´ --- */
        #penguin {
            position: absolute;
            bottom: 40px;
            left: 10%;
            font-size: 5rem;
            z-index: 20;
            /* ä¸‹è¨˜ã®!importantä»˜ãstyleãŒå„ªå…ˆã•ã‚Œã¾ã™ */
            transition: transform 0.2s;
        }

        /* --- ã€å¤‰æ›´ã€‘æ–‡å­—ã‚’æ¶ˆã—ã€ç©´ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚’èª¿æ•´ --- */
        #pit {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 15%;
            height: 100%;
            background: linear-gradient(to bottom, #000, var(--ocean-blue));
            clip-path: polygon(20% 0, 100% 0, 100% 100%, 0% 100%);
        }

        /* --- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ --- */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
        }

        button {
            padding: 20px 60px;
            font-size: 2rem;
            background: var(--term-green);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #009432;
        }
        button:active { transform: translateY(5px); box-shadow: none; }

        .miss-flash { animation: flash 0.1s; }
        @keyframes flash {
            from { background-color: var(--error-red); }
            to { background-color: transparent; }
        }
    </style>
</head>
<body onclick="initAudio()">

<div style="position: absolute; top: 10px; left: 0; width: 100%; display: flex; justify-content: space-around; z-index: 100; color: white; font-family: monospace; font-size: 2rem; pointer-events: none; text-shadow: 2px 2px 4px black;">
    <div>TIME: <span id="ui-time">120</span></div>
    <div>SCORE: <span id="ui-score">0</span></div>
</div>

<div id="world">
    <div id="sky">
        <div class="cloud" style="top: 20%; animation-duration: 25s;"></div>
        <div class="cloud" style="top: 50%; animation-duration: 40s; width: 150px;"></div>
    </div>
    
    <div id="typing-area">
        <div id="cmd-display">
            <div id="target-desc">PRESS START</div>
            <div id="target-text">LPIC RESCUE</div>
        </div>
    </div>

    <div id="ground">
        <div id="penguin">ğŸ§</div>
        <div id="pit"></div>
    </div>
</div>

<div id="start-screen" class="overlay">
    <h1 style="font-size: 4rem;">ğŸ§ ãƒšãƒ³ã‚®ãƒ³æ•‘å‡ºä½œæˆ¦</h1>
    <p style="font-size: 1.5rem; margin-bottom: 30px;">LPICã‚¿ã‚¤ãƒ”ãƒ³ã‚°ï½ç©´ã«è½ã¡ã‚‹å‰ã«ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡è¾¼ã‚ï¼ï½</p>
    <button onclick="startGame()">ãƒ¬ã‚¹ã‚­ãƒ¥ãƒ¼é–‹å§‹ (Enter)</button>
</div>

<div id="result-screen" class="overlay" style="display: none;">
    <h2 id="result-title" style="font-size: 3rem;">FINISH!</h2>
    <div id="stats" style="font-size: 1.5rem; margin: 30px; text-align: center;"></div>
    <button onclick="location.reload()">å†æŒ‘æˆ¦</button>
</div>

<script>
    const questions = [
        { cmd: "ls -la", desc: "éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€è©³ç´°è¡¨ç¤º" },
        { cmd: "ls -ltr", desc: "å¤ã„é †ã«è¡¨ç¤º" },
        { cmd: "cp -rp src/ dest/", desc: "å±æ€§ä¿æŒã‚³ãƒ”ãƒ¼" },
        { cmd: "rm -rf /tmp/old", desc: "å¼·åˆ¶ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‰Šé™¤" },
        { cmd: "mkdir -p /a/b/c", desc: "éšå±¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ" },
        { cmd: "chmod 755 script", desc: "å®Ÿè¡Œæ¨©é™ä»˜ä¸" },
        { cmd: "chown root:root file", desc: "æ‰€æœ‰è€…å¤‰æ›´" },
        { cmd: "grep -i 'error' file", desc: "å¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–æ¤œç´¢" },
        { cmd: "systemctl start sshd", desc: "SSHèµ·å‹•" },
        { cmd: "df -h", desc: "ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡è¡¨ç¤º" },
        { cmd: "ip addr show", desc: "IPç¢ºèª" },
        { cmd: "tail -f /var/log", desc: "ãƒ­ã‚°ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–" },
        { cmd: "apt update && apt upgrade", desc: "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°" },
        { cmd: "/etc/shadow", desc: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«" }
    ];

    let currentQ, typedIndex, score, timeLeft, gameActive = false;
    let audioCtx = null;
    
    let questionStartTime = 0; 
    const FIXED_LIMIT = 10; 
    const START_POS = 10;   
    const END_POS = 75;     

    const style = document.createElement('style');
    style.innerHTML = `
        #penguin { 
            transition: transform 0.2s ease-out !important; 
        }
    `;
    document.head.appendChild(style);

    function initAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    function playSound(freq, type, duration) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function refreshUI() {
        document.getElementById('ui-time').innerText = timeLeft;
        document.getElementById('ui-score').innerText = score;
    }

    function startGame() {
        if (gameActive) return;
        document.getElementById('start-screen').style.display = 'none';
        gameActive = true;
        score = 0;
        timeLeft = 120; 
        refreshUI();    
        nextQuestion();
        requestAnimationFrame(gameLoop);
        
        const mainTimer = setInterval(() => {
            if(gameActive) {
                timeLeft--;
                refreshUI(); 
                if(timeLeft <= 0) {
                    clearInterval(mainTimer);
                    endGame();
                }
            }
        }, 1000);
    }

    function nextQuestion() {
        currentQ = questions[Math.floor(Math.random() * questions.length)];
        typedIndex = 0;
        questionStartTime = performance.now(); 
        updateDisplay();
    }

    function updateDisplay() {
        let html = "";
        for (let i = 0; i < currentQ.cmd.length; i++) {
            if (i < typedIndex) html += `<span class="correct">${currentQ.cmd[i]}</span>`;
            else if (i === typedIndex) html += `<span class="current">${currentQ.cmd[i]}</span>`;
            else html += `<span>${currentQ.cmd[i]}</span>`;
        }
        document.getElementById('target-text').innerHTML = html;
        document.getElementById('target-desc').innerText = currentQ.desc;
    }

    function gameLoop(currentTime) {
        if (!gameActive) return;

        const elapsed = (currentTime - questionStartTime) / 1000;
        const progress = Math.min(elapsed / FIXED_LIMIT, 1);

        // æ¨ªä½ç½®
        const currentPos = START_POS + ((END_POS - START_POS) * progress);
        document.getElementById('penguin').style.left = currentPos + "%";

        // ã€è¿½åŠ ã€‘å‚é“ã«åˆã‚ã›ã¦é«˜ã•ã‚’å¤‰ãˆã‚‹ (ã‚¹ã‚¿ãƒ¼ãƒˆ110pxã‹ã‚‰å¾ã€…ã«25pxã¸æ»‘ã‚Šè½ã¡ã‚‹)
        const currentBottom = 110 - (progress * 85);
        document.getElementById('penguin').style.bottom = currentBottom + "px";

        if (elapsed >= FIXED_LIMIT) {
            playSound(150, 'sawtooth', 0.3);
            score = Math.max(0, score - 50);
            refreshUI(); 
            nextQuestion(); 
        }

        requestAnimationFrame(gameLoop);
    }

    window.addEventListener('keydown', (e) => {
        if (!gameActive) {
            if (e.key === 'Enter') startGame();
            return;
        }
        if (e.key.length > 1) return;

        if (e.key === currentQ.cmd[typedIndex]) {
            typedIndex++;
            playSound(600, 'sine', 0.05);
            if (typedIndex >= currentQ.cmd.length) {
                score += 100;
                refreshUI(); 
                playSound(1000, 'sine', 0.1);
                
                const p = document.getElementById('penguin');
                p.style.transform = 'translateY(-50px) rotate(360deg)';
                setTimeout(() => {
                    p.style.transform = 'translateY(0) rotate(0)';
                    nextQuestion();
                }, 200);
            } else {
                updateDisplay();
            }
        } else {
            playSound(200, 'square', 0.1);
            document.body.classList.add('miss-flash');
            setTimeout(() => document.body.classList.remove('miss-flash'), 100);
        }
    });

    function endGame() {
        gameActive = false;
        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('stats').innerHTML = `ã‚¹ã‚³ã‚¢: ${score}ç‚¹<br>LPICãƒ¬ãƒ™ãƒ«: ${score > 1500 ? 'å®Ÿå‹™ãƒ¬ãƒ™ãƒ«' : 'ä¸€èˆ¬ãƒ¬ãƒ™ãƒ«'}`;
    }
</script>
</body>
</html>
